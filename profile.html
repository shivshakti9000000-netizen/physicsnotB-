<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile | PhysicsnotB</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root { --bg: #f8fafc; --surface: #ffffff; --primary: #2563eb; --text: #1e293b; --border: #e2e8f0; }
        [data-theme="dark"] { --bg: #0f172a; --surface: #1e293b; --primary: #38bdf8; --text: #f1f5f9; --border: #334155; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); padding-bottom: 80px; }

        .profile-header { text-align: center; padding: 3rem 1rem; background: var(--surface); border-bottom: 1px solid var(--border); }
        .avatar { width: 100px; height: 100px; background: var(--primary); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 2.5rem; font-weight: 800; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 1.5rem; }
        .stat-card { background: var(--surface); padding: 1.5rem; border-radius: 16px; text-align: center; border: 1px solid var(--border); }
        .stat-card h2 { color: var(--primary); font-size: 1.8rem; }

        .settings-list { padding: 0 1.5rem; }
        .setting-item { display: flex; align-items: center; gap: 15px; padding: 15px; background: var(--surface); border-radius: 12px; margin-bottom: 10px; border: 1px solid var(--border); font-weight: 600; }

        /* Bottom Nav (Same as others) */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: var(--surface); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid var(--border); z-index: 1000; }
        .nav-item { color: #64748b; text-decoration: none; font-size: 0.7rem; text-align: center; flex: 1; font-weight: 600; }
        .nav-item.active { color: var(--primary); }
    </style>
</head>
<body>

    <div class="profile-header">
        <div class="avatar" id="profileInitial">L..</div>
      <h3 id="userName">Loading...</h3>

       </div>

    <div class="stats-grid">
        <div class="stat-card">
            <h2 id="totalPts">0</h2>
            <p style="font-size: 0.8rem; color: #64748b;">Total Points</p>
        </div>
        <div class="stat-card">
            <h2>load...</h2>
            <p style="font-size: 0.8rem; color: #64748b;">Videos Watched</p>
        </div>
    </div>

    <div class="settings-list">
        <div class="setting-item" onclick="toggleTheme()"><i data-lucide="moon"></i> Dark Mode</div>
        <div class="setting-item" id="logoutBtn" style="color: #ef4444;"><i data-lucide="log-out"></i> Sign Out</div>
    </div>

    <nav class="bottom-nav">
        <a href="dashboard.html" class="nav-item"><i data-lucide="home"></i><br>Home</a>
        <a href="videos.html" class="nav-item"><i data-lucide="play"></i><br>Videos</a>
        <a href="community.html" class="nav-item"><i data-lucide="message-circle"></i><br>Chat</a>
        <a href="profile.html" class="nav-item active"><i data-lucide="user"></i><br>Profile</a>
    </nav>

    <script type="module" src="app.js"></script>
    <script>
        lucide.createIcons();
    </script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const videoConfig = {
        apiKey: "AIzaSyB3zKexi3a-4WniftHc_00Tc8rcRdda7pY",
        authDomain: "comj-b7bf6.firebaseapp.com",
        projectId: "comj-b7bf6",
        storageBucket: "comj-b7bf6.firebasestorage.app",
        appId: "1:137177672880:web:307a4cec9b901c6e8ddf75"
    };

    const vApp = initializeApp(videoConfig);
    const vDB = getFirestore(vApp);
    const realUser = localStorage.getItem('studentName') || "Student";

    // 1. Profile Initial & Name Setup
    function setupProfile() {
        document.getElementById('userName').innerText = realUser;
        // Naam ka pehla akshar dikhane ke liye
        document.getElementById('profileInitial').innerText = realUser.charAt(0).toUpperCase();
        
        // Theme load karna
        const savedTheme = localStorage.getItem('siteTheme') || 'light';
        document.body.setAttribute('data-theme', savedTheme);
    }

    // 2. Real-time Stats Sync
    function syncStats() {
        if (realUser === "Student") return;

        const studentRef = doc(vDB, "students", realUser);
        onSnapshot(studentRef, (snap) => {
            if (snap.exists()) {
                const data = snap.data();
                // IDs match honi chahiye jo niche HTML mein hain
                document.getElementById('totalPts').innerText = data.score || 0;
                document.getElementById('watchedCount').innerText = data.videosWatched || 0;
            }
        });
    }

    // 3. Settings Actions
    window.toggleTheme = function() {
        const current = document.body.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        document.body.setAttribute('data-theme', next);
        localStorage.setItem('siteTheme', next);
        lucide.createIcons();
    };

    document.getElementById('logoutBtn').onclick = () => {
        if(confirm("Boss, kya aap sach mein logout karna chahte hain?")) {
            localStorage.clear();
            window.location.href = 'index.html';
        }
    };

    // Initialize
    setupProfile();
    syncStats();
</script>

</body>
</html>